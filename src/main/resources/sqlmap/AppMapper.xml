<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hs.web.mapper.AppMapper">

    <select id="search" parameterType="dbmap" resultType="dbmap">
        SELECT
                memberid,
                password,
                grade,
                gubun,
                openflag,
                name,
                telephone,
                handphone,
                address,
                address_etc,
                introduce,
                latitude,
                longitude,
                usestartdate,
                useenddate,
                deleteyn,
                lastconnecttime,
                regtime
                FROM member
        WHERE deleteyn = 0
        <if test='gubun != null and gubun != "" and gubun == "1"'>AND gubun in ("1","2")/*all*/</if>
        <if test='gubun != null and gubun != "" and gubun == "2"'>AND gubun = "1"/*약국('1')*/</if>
        <if test='gubun != null and gubun != "" and gubun == "3"'>AND gubun = "2"/*병원('2')*/</if>

        <if test='latitude != null and latitude != "" and latitude != "0"'>
            AND latitude BETWEEN (#{latitude}-0.0090090090) AND (#{latitude}+0.0090090090)
        </if>
        <if test='longitude != null and longitude != "" and longitude != "0"'>
            AND longitude  BETWEEN (#{longitude}-0.0112612612) AND (#{longitude}+0.0112612612)
        </if>
    </select>

    <select id="detail" parameterType="dbmap" resultType="dbmap">
        SELECT
                A.memberid,
                A.password,
                A.grade,
                A.gubun,
                A.openflag,
                A.name,
                A.telephone,
                A.handphone,
                A.address,
                A.address_etc,
                A.introduce,
                A.latitude,
                A.longitude,
                A.deleteyn,
                A.lastconnecttime,
                DATE_FORMAT( A.usestartdate,'%Y.%m.%d') "usestartdate",
                DATE_FORMAT( A.useenddate,'%Y.%m.%d') "useenddate",
                DATE_FORMAT( A.regtime,'%Y.%m.%d') "regtime"
        FROM member A
        WHERE 1=1 AND A.memberid = #{memberid}
    </select>

    <select id="playOne" parameterType="dbmap" resultType="dbmap">
        <![CDATA[
        SELECT
                adindex,
                adtitle,
                adowner,
                telephone,
                usestartdate,
                useenddate,
                playorder,
                filename,
                regtime
        FROM adinfo
        WHERE usestartdate <= NOW()
        AND useenddate >= NOW()
        ORDER BY playorder ASC
        LIMIT 0,1
        ]]>
    </select>

    <select id="playList" parameterType="dbmap" resultType="dbmap">
        <![CDATA[
        SELECT
                filename
        FROM adinfo
        WHERE usestartdate <= NOW()
        AND useenddate >= NOW()
        ORDER BY playorder ASC
        ]]>
    </select>

    <select id="getPlayList" parameterType="dbmap" resultType="dbmap">
        <![CDATA[
        SELECT CONCAT("/upload/adinfo/",filename) filename
        FROM adinfo
        WHERE usestartdate <= NOW()
        AND useenddate >= NOW()
        ORDER BY playorder ASC
        ]]>
    </select>
</mapper>